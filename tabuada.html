<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Tabuada Hero</title>
<style>
:root{
  --bg1: #f6f9ff; --card: #ffffff; --accent: #ff7a7a; --accent2: #6fcf97;
  --muted: #6b7280; --shadow: 0 10px 30px rgba(17,24,39,0.08);
}
body{margin:0;font-family:"Comic Sans MS",cursive,sans-serif;
  background:linear-gradient(180deg,#e8f0ff 0%, #fef6f2 100%);color:#102a43;
  display:flex;justify-content:center;padding:20px}
.wrap{max-width:960px;width:100%;background:var(--card);border-radius:12px;
  box-shadow:var(--shadow);overflow:hidden}
.topbar{display:flex;justify-content:space-between;align-items:center;padding:12px 20px;
  border-bottom:1px solid #eef2ff}
.brand{display:flex;align-items:center;gap:12px}.brand h1{margin:0;color:var(--accent2)}
.logo{font-size:28px}.hud{display:flex;gap:16px;color:var(--muted);font-weight:bold}
.main{padding:18px;display:grid;gap:16px}
.card{background:#fff9;border-radius:10px;padding:18px;box-shadow:0 6px 18px rgba(0,0,0,0.05)}
.hidden{display:none}
.btn{padding:10px 14px;border-radius:8px;border:0;cursor:pointer;font-weight:bold}
.btn.primary{background:var(--accent2);color:#fff}.btn.ghost{background:#eee}
.field{display:flex;flex-direction:column;margin:8px 0}
input,textarea,select{padding:10px;border-radius:8px;border:1px solid #ccc}
#gameCanvas{width:100%;height:auto;border-radius:8px;border:2px solid #cde;
  background:linear-gradient(180deg,#bfe9d8,#e0f7fa)}
.question-panel{margin-top:10px}.question{font-size:20px;font-weight:bold}
.answer-row{display:flex;gap:8px;margin-top:6px}
.feedback{margin-top:6px;font-weight:bold}
.overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
  background:rgba(0,0,0,0.5)}.overlay-card{background:#fff;padding:20px;border-radius:12px;text-align:center}
.summaryBox{background:#fff;border:1px solid #ccc;padding:10px;border-radius:8px;
  height:200px;overflow:auto;white-space:pre-wrap}
.footer{padding:10px;text-align:center;font-size:13px;color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
<header class="topbar">
  <div class="brand"><span class="logo">üê£</span><h1>Tabuada Hero</h1></div>
  <div class="hud"><div>Score: <span id="score">0</span></div>
  <div>Vidas: <span id="lives">3</span></div><div>N√≠vel: <span id="level">1</span></div></div>
</header>
<main class="main">
<section id="intro" class="card">
  <h2>Bem-vindo!</h2>
  <p>Resolva as contas para ajudar o bichinho a pular obst√°culos. Use ‚Üê ‚Üí para andar, ‚Üë / espa√ßo para pular.</p>
  <label class="field">Seu e-mail: <input id="studentEmail" type="email"></label>
  <label class="field">N√≠vel inicial:
    <select id="startLevel"></select>
  </label>
  <button id="btnStart" class="btn primary">Iniciar</button>
</section>

<section id="gameArea" class="card hidden">
  <canvas id="gameCanvas" width="820" height="260"></canvas>
  <div class="question-panel">
    <div class="question" id="questionText">Pergunta</div>
    <div class="answer-row">
      <input id="answerInput" type="number" placeholder="Resposta">
      <button id="btnSubmit" class="btn primary">Enviar</button>
      <button id="btnSkip" class="btn ghost">Pular</button>
    </div>
    <div id="feedback" class="feedback"></div>
  </div>
</section>

<section id="summary" class="card hidden">
  <h2>Resumo do n√≠vel</h2>
  <pre id="summaryText" class="summaryBox"></pre>
  <form id="emailForm">
    <label class="field">Confirmar seu e-mail:
      <input id="formStudentEmail" type="email" required>
    </label>
    <label class="field">Mensagem:
      <textarea id="formMessage" rows="8"></textarea>
    </label>
    <button id="sendMailBtn" type="submit" class="btn primary">Enviar ao professor</button>
    <button id="closeSummary" type="button" class="btn ghost">Voltar ao jogo</button>
  </form>
  <small>O resumo ser√° enviado para <b>gabrieli.rizzi.cruz@escola.pr.gov.br</b></small>
</section>
</main>
<div class="footer">Tabuada Hero ¬∑ vers√£o teste com 5 contas por n√≠vel</div>
</div>

<script>
const PROFESSOR_EMAIL="gabrieli.rizzi.cruz@escola.pr.gov.br";
const QUESTIONS_PER_LEVEL=5, TOTAL_LEVELS=10;
const studentEmailEl=document.getElementById("studentEmail");
const startLevelEl=document.getElementById("startLevel");
const btnStart=document.getElementById("btnStart");
const gameArea=document.getElementById("gameArea");
const scoreEl=document.getElementById("score");
const livesEl=document.getElementById("lives");
const levelEl=document.getElementById("level");
const questionText=document.getElementById("questionText");
const answerInput=document.getElementById("answerInput");
const btnSubmit=document.getElementById("btnSubmit");
const btnSkip=document.getElementById("btnSkip");
const feedbackEl=document.getElementById("feedback");
const summary=document.getElementById("summary");
const summaryText=document.getElementById("summaryText");
const formStudentEmail=document.getElementById("formStudentEmail");
const formMessage=document.getElementById("formMessage");
const emailForm=document.getElementById("emailForm");
const closeSummary=document.getElementById("closeSummary");

const canvas=document.getElementById("gameCanvas");const ctx=canvas.getContext("2d");
let hero={x:60,y:200,w:36,h:36,vy:0,onGround:true};
let gravity=0.8, keys={};
let state={score:0,lives:3,level:1,qIndex:0,questions:[],logs:[],currentQ:null,student:""};

for(let i=1;i<=TOTAL_LEVELS;i++){let o=document.createElement("option");o.value=i;o.textContent=i;startLevelEl.appendChild(o);}

function randInt(a,b){return Math.floor(Math.random()*(b-a+1))+a;}
function genQuestions(n){let arr=[];for(let i=0;i<QUESTIONS_PER_LEVEL;i++){let a=randInt(1,10);arr.push({a:a,b:n,answer:a*n});}return arr;}

function startGame(){
  if(!studentEmailEl.value){alert("Digite seu e-mail");return;}
  state.student=studentEmailEl.value;state.level=parseInt(startLevelEl.value)||1;
  state.score=0;state.lives=3;nextLevel();
  document.getElementById("intro").classList.add("hidden");
  gameArea.classList.remove("hidden");summary.classList.add("hidden");
  requestAnimationFrame(loop);
}

function nextLevel(){
  state.qIndex=0;state.logs=[];state.questions=genQuestions(state.level);
  updateHUD();nextQuestion();
}

function nextQuestion(){
  if(state.qIndex>=state.questions.length){showSummary();return;}
  state.currentQ=state.questions[state.qIndex];
  questionText.textContent=`Quanto √© ${state.currentQ.a} √ó ${state.currentQ.b}? (${state.qIndex+1}/${QUESTIONS_PER_LEVEL})`;
  feedbackEl.textContent="";answerInput.value="";
}

function submitAns(skip=false){
  const q=state.currentQ; if(!q) return;
  let val=skip?null:Number(answerInput.value);
  let ok=(val===q.answer);
  let line=`${q.a}√ó${q.b} = ${skip?"(pulou)":val} ‚Üí ${ok?"‚úî":"‚úò"}`;
  state.logs.push(line);
  if(ok){feedbackEl.textContent="‚úÖ Correto";state.score+=10;hero.vy=-12;hero.onGround=false;}
  else{feedbackEl.textContent=`‚ùå Errado (correto ${q.answer})`;state.lives--;}
  updateHUD();state.qIndex++;
  setTimeout(()=>{if(state.lives<=0){alert("Game Over! Reinicie a p√°gina.");}
  else nextQuestion();},700);
}

function updateHUD(){scoreEl.textContent=state.score;livesEl.textContent=state.lives;levelEl.textContent=state.level;}

function showSummary(){
  gameArea.classList.add("hidden");summary.classList.remove("hidden");
  summaryText.textContent=state.logs.join("\\n");
  formStudentEmail.value=state.student;
  formMessage.value=`Resumo n√≠vel ${state.level}\\n`+state.logs.join("\\n");
}

emailForm.addEventListener("submit",e=>{
  e.preventDefault();
  const mail=`mailto:${PROFESSOR_EMAIL}?subject=Resumo%20Tabuada%20Hero%20-%20${encodeURIComponent(state.student)}&body=${encodeURIComponent(formMessage.value)}`;
  window.location.href=mail;
});
closeSummary.addEventListener("click",()=>{
  summary.classList.add("hidden");
  state.level++;
  if(state.level<=TOTAL_LEVELS){nextLevel();gameArea.classList.remove("hidden");}
  else alert("üéâ Parab√©ns! Concluiu todos os n√≠veis!");
});

btnStart.addEventListener("click",startGame);
btnSubmit.addEventListener("click",()=>submitAns(false));
btnSkip.addEventListener("click",()=>submitAns(true));
answerInput.addEventListener("keydown",e=>{if(e.key==="Enter")submitAns(false);});

// movimento simples
window.addEventListener("keydown",e=>{keys[e.key]=true;});
window.addEventListener("keyup",e=>{keys[e.key]=false;});

function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#654321";ctx.fillRect(0,236,canvas.width,24);
  // hero
  ctx.fillStyle="#ff6b6b";ctx.fillRect(hero.x,hero.y-hero.h,hero.w,hero.h);
  // physics
  if(!hero.onGround){hero.y+=hero.vy;hero.vy+=gravity;if(hero.y>=200){hero.y=200;hero.vy=0;hero.onGround=true;}}
  if(keys["ArrowLeft"]) hero.x-=3;if(keys["ArrowRight"]) hero.x+=3;if((keys["ArrowUp"]||keys[" "])&&hero.onGround){hero.vy=-12;hero.onGround=false;}
  hero.x=Math.max(0,Math.min(canvas.width-hero.w,hero.x));
  requestAnimationFrame(loop);
}
</script>
</body>
</html>
